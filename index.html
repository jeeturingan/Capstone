<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Lithophane Generator Prototype</title>
    <!--our style sheet-->
    <link rel="stylesheet" href="css/main.css">
  </head>

  <!--ThreeJS Java Scripts-->
  <script src="js/threejs/three.js"></script>
  <script src="js/threejs/OrbitControls.js"></script>
  <script src="js/threejs/TrackballControls.js"></script>
  <script src="js/threejs/WebGL.js"></script>

  <script src="js/threejs/stats.min.js"></script>
  <script src="js/threejs/CurveExtras.js"></script>
  <script src="js/threejs/Geometry.js"></script>
  <script src="js/threejs/BufferGeometry.js"></script>
  <script src="js/threejs/BufferAttribute.js"></script>
  <script src="js/threejs/Vector3.js"></script>
  <script src="js/threejs/ParametricGeometries.js"></script>

  <!--our Java Script-->
  <script src="js/main.js"></script>

  <body onload="initPage();">
    <!--call function when page loaded-->
    <h1 id="pageheading">Lithophane Generator</h1>

    <form>
      Max Size (1mm-1000mm): <input type="text" name="max_size" id="max_size"><br>
      Thickness (1mm-100mm): <input type="text" name="thickness"><br>
      Border (0mm and Output Dimension/2): <input type="text" name="border"><br>
      Thinnest Layer (0.1mm and Thickness in mm): <input type="text" name="thinnest_layer"><br>
      Vectors per Pixel (1 and 5): <input type="text" name="vector"><br>
      Base/Stand depth (-50 mm and 50 mm): <input type="text" name="base"><br><br>
    </form>

    <form type=get action="index.html">
      <p class="text-primary">Plain Text: <input type="text" name="plain_text" id="plain_text"></p>
      <font face="Braille"><p class="text-primary" name="braille_code" id="braille_code">Plain Text</p></font>

      <!--<button class="btn btn-primary" type=submit value="Submit" id ="btnTranslate"
      onclick="processBraille(document.getElementById('plain_text').value, document.getElementById("braille_code"))">Translate</button>
      <button class = "btn btn-primary" value="Refresh Page" onClick="window.location.reload();">Refresh</button>-->
    </form>

    <script>
      if ( WEBGL.isWebGLAvailable() === false )
      {
        document.body.appendChild( WEBGL.getWebGLErrorMessage() );
      }

      var plain_text = document.getElementById('plain_text').value;
      var braille_text = document.getElementById('braille_code');

      var lithoBraille = new THREE.Geometry();

      var scene = new THREE.Scene();
      scene.background = new THREE.Color( 0xf2f2f2 );

      var camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );
      //camera.position.z = 5;
      camera.position.set (0, 0, 100);
      //camera.rotation.x += 180 * Math.PI / 180;

      var renderer = new THREE.WebGLRenderer();
      renderer.setSize( 1000, 500 );
      document.body.appendChild( renderer.domElement );
      renderer.shadowMap.enabled = true;
      renderer.shadowMap.type = THREE.PCFSoftShadowMap;
      renderer.gammaInput = true;
      renderer.gammaOutput = true;

      var controls = new THREE.TrackballControls( camera );
      //controls.update();
      controls.rotateSpeed = 2;
      controls.zoomSpeed = 2;
      controls.panSpeed = 2;
      controls.noZoom = false;
      controls.noPan = false;
      controls.staticMoving = true;
      controls.dynamicDampingFactor = 0.3;
      controls.keys = [ 65, 83, 68 ];
      controls.addEventListener( 'change', render );

      var spotLight = new THREE.SpotLight(0xffffff, 1, 0);
      spotLight.position.set(-1000, 1000, 1000);
      spotLight.castShadow = false;
      scene.add(spotLight);
      var pointLight = new THREE.PointLight(0xffffff, 1, 0);
      pointLight.position.set(3000, -4000, 3500);
      scene.add(pointLight);

      var addBackLights=true;
      if (addBackLights)
      {
          var spotLight = new THREE.SpotLight(0xffffff, 1, 0);
          spotLight.position.set(-1000, 1000, -1000);
          spotLight.castShadow = false;
          scene.add(spotLight);
          var pointLight = new THREE.PointLight(0xffffff, 1, 0);
          pointLight.position.set(3000, -4000, -3500);
          pointLight.castShadow = false;
          scene.add(pointLight);
      }

      var vertexPixelRatio = 4;
      var baseWidth = 300*vertexPixelRatio;
      var divisions = Math.floor(baseWidth / (vertexPixelRatio * 10)); // 10mm grid
      var groundMaterial = new THREE.MeshLambertMaterial({ color: 0x808080, wireframe: true , side: THREE.DoubleSide});
      var groundPlane = new THREE.PlaneGeometry(baseWidth, baseWidth, divisions, divisions);
      groundPlane.applyMatrix(new THREE.Matrix4().makeTranslation(0, 0, -0.05));// move down a fraction so that object shows properly from underneath the floor
      var ground = new THREE.Mesh(groundPlane, groundMaterial);
      scene.add(ground);

      render();
      animate();

      function animate() {
        requestAnimationFrame( animate );
        //cube.rotation.x += 0.01;
        //cube.rotation.y += 0.01;
        controls.update();
        renderer.render( scene, camera );
      }

      function render() {
        renderer.render( scene, camera );
      }

    </script>


    <!--<script src="js/braille.js"></script>-->

    <!--<img src="pictures/henry-vii-m.jpg" onclick="onImageClicked(event);">
    <canvas id="outputcanvas" style="width:273px;height:480px"></canvas>-->

    <input type="file" id="js-upload-files" onchange="previewFile()">
    <img src="" onclick="onImageClicked(event);">
    <!--<img src="pictures/dogs.jpg" onclick="onImageClicked(event);">-->
    <canvas id="outputcanvas" style="heigh:480px;width:768px"></canvas>

    <button class="btn btn-primary" type=submit value="Submit" id ="btnTranslate"
    onclick="downloadBraille3D()">Download as STL</button>
  </body>
</html>
